- [x] Implement result reference substitution so method arguments like `#mailboxCreationId` are resolved before invoking handlers (`apps/backend/src/jmap.routes.ts:78-149`) to reach baseline RFC 8621 compliance.
- [x] Enforce per-method capability requirements instead of only rejecting unknown capabilities, returning `unknownCapability` when `using` omits `urn:ietf:params:jmap:mail`, `submission`, etc. (`apps/backend/src/jmap.routes.ts:60-141`).
- [x] Replace the one-shot `/jmap/event-source` response with a long-lived SSE stream that emits incremental state diffs from `change_log` (`apps/backend/src/jmap.routes.ts:211-247`).
- [x] Rework `normalizeFilter` so `Email/query` can combine multiple filter properties simultaneously instead of discarding everything after the first key (`apps/backend/src/lib/jmap/method-handlers/email-query.ts:134-247`).
- [x] Push `Email/query` pagination/sorting into SQL with `LIMIT/OFFSET` and only compute totals when requested to avoid materializing the entire mailbox on every call (`apps/backend/src/lib/jmap/method-handlers/email-query.ts:249-284`).
- [x] Persist filtered query states so `Email/queryChanges` can honor a `filter` rather than returning `unsupportedFilter` for anything but the default view (`apps/backend/src/lib/jmap/method-handlers/email-query-changes.ts:22-74`).
- [x] Sort the `emailIds` returned by `Thread/get` (e.g., newest first) to satisfy the ordering guarantee in RFC 8621 (`apps/backend/src/lib/jmap/method-handlers/thread-get.ts:24-55`).
- [x] Expand `Mailbox/query` to accept filter/sort/position arguments and correctly report `canCalculateChanges` instead of always returning the full list (`apps/backend/src/lib/jmap/method-handlers/mailbox-query.ts:15-42`).
- [x] Return accurate per-mailbox rights and thread counts (total/unread) in `Mailbox/get` rather than hard-coding permissive booleans for every mailbox (`apps/backend/src/lib/jmap/method-handlers/mailbox-get.ts:13-83`).
- [x] Store normalized text/html bodies at ingest time (e.g., in `apps/backend/src/lib/mail/ingest.ts`) and have `Email/get` serve `bodyValues` from the database instead of reparsing each MIME blob from R2 (`apps/backend/src/lib/jmap/method-handlers/email-get.ts:320-464`).
- [x] Stream blobs from R2 (or issue byte-range reads) inside `Blob/get` so we never buffer entire multi-megabyte objects just to return a slice or digest (`apps/backend/src/lib/jmap/method-handlers/blob.ts:90-230`).
- [x] Add per-IP/user rate limiting (and logging) to `/auth/login` and `/auth/register` to mitigate brute-force attempts (`apps/backend/src/auth.routes.ts:18-86`).
- [ ] Verify the incoming SNS `TopicArn` matches the configured SES topic before updating submission status, alerting on mismatches (`apps/backend/src/ses-webhook.routes.ts:52-205`).

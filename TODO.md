- [x] `Email/set` mailboxIds patch currently behaves like a full replacement and ignores `false` flags (`apps/backend/src/lib/jmap/method-handlers/email-set.ts:1154` and `:1497`). Update the logic so mailboxIds booleans add/remove memberships incrementally per RFC 8621, and allow pure removal patches unless they would leave the Email without any mailbox.
- [x] When removing a mailbox, `removeMailboxMemberships` simply deletes memberships even if that leaves affected Emails with zero mailboxes (`apps/backend/src/lib/jmap/method-handlers/mailbox-set.ts:151`). Ensure each Email still has at least one mailbox afterward (e.g., move to Inbox/Trash or reject destroy).
- [x] `Mailbox/set` never checks for duplicate names among siblings (`apps/backend/src/lib/jmap/method-handlers/mailbox-set.ts:255`), allowing multiple child mailboxes with the same case-insensitive name under one parent. Add uniqueness validation for both create and update operations as required by RFC 8621.
- [x] `Email/set` now reports successful updates under the resolved id instead of the id provided in the request (`apps/backend/src/lib/jmap/method-handlers/email-set.ts:254`). JMAP requires `updated` keys to match the request keys (which might be `#creationId`), so keep the client-supplied key while still returning the canonical id in the value.
- [x] The `mailboxIds` maps passed to `Email/set` create/update still can't reference `#` result references from earlier method calls (`apps/backend/src/lib/jmap/method-handlers/email-set.ts:391` and `:1497`). Resolve creation ids for mailbox ids so clients can immediately target mailboxes created earlier in the same JMAP request.

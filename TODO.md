- [x] `Mailbox/set` currently lets clients supply or change `role` during both create and update (`apps/backend/src/lib/jmap/method-handlers/mailbox-set.ts:43-133`), but RFC 8621 §2.4 declares `Mailbox.role` as server-set/readOnly, so these writes must be rejected to stay compliant.
- [x] Destroying a mailbox is rejected whenever it still contains any emails (`mailbox-set.ts:387-411`). RFC 8621 §2.4 requires servers to automatically remove the mailbox id from the affected `Email.mailboxes` instead of forcing clients to empty the mailbox first, so implement cascading removal instead of throwing `mailboxHasEmail`.
- [x] `Email/set` never resolves `#`-prefixed result references inside `mailboxIds` or `destroy` ids (`email-set.ts:1088-1165` and `email-set.ts:1360-1456`), which violates RFC 8620 §3.4 (clients must be able to reference objects created earlier in the same request). Add general creation id resolution so emails can target freshly-created mailboxes or reference ids produced earlier in the request.
- [x] `Email/get` accepts any `properties`/`bodyProperties` array and merely drops unknown fields (`email-get.ts:57-140`), but RFC 8620 §5.1 mandates returning `invalidArguments` when a client requests unsupported properties. Add explicit validation against the allowed property set for both `properties` and `bodyProperties`.
- [x] Both `Mailbox/query` and `Email/query` silently ignore filter keys they do not understand by collapsing them into the default filter (`mailbox-query.ts:94-134`, `email-query.ts:176-302`). RFC 8620 §5.1 requires returning an `unsupportedFilter` error when any supplied filter is not supported, so detect unknown conditions instead of executing a broader query than requested.
